<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>노선도</title>
    <link rel="stylesheet" href="/css/map.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Advent+Pro&family=Orbitron:wght@800;900&display=swap" rel="stylesheet">
</head>
<body>
<div id="container">
    <div class="header">
        <a href="main"><h1>WETRO</h1></a>
    </div>
    <div class="main">

    </div>
    <div class="map">
        <img src="/img/map.png" usemap="#map" alt="No view" id="fullMap">
        <map name="map" id="map">
            <area shape="circle" coords="44, 367, 8" href="#" alt="101" class="popup-trigger">
            <area shape="circle" coords="44, 432, 8" href="#" alt="102" class="popup-trigger">
            <area shape="circle" coords="44, 504, 8" href="#" alt="103" class="popup-trigger">
            <area shape="circle" coords="45, 574, 8" href="#" alt="104" class="popup-trigger-bottom">
            <area shape="circle" coords="44, 646, 8" href="#" alt="105" class="popup-trigger-bottom">
            <area shape="circle" coords="79, 697, 8" href="#" alt="106" class="popup-trigger-bottom">
            <area shape="circle" coords="157, 698, 8" href="#" alt="107" class="popup-trigger-bottom">
            <area shape="circle" coords="216, 699, 8" href="#" alt="108" class="popup-trigger-bottom">
            <area shape="circle" coords="274, 699, 8" href="#" alt="109" class="popup-trigger-bottom">
            <area shape="circle" coords="352, 698, 8" href="#" alt="110" class="popup-trigger-bottom">
            <area shape="circle" coords="430, 699, 8" href="#" alt="111" class="popup-trigger-bottom">
            <area shape="circle" coords="507, 699, 8" href="#" alt="112" class="popup-trigger-bottom">
            <area shape="circle" coords="599, 699, 8" href="#" alt="113" class="popup-trigger-bottom">
            <area shape="circle" coords="636, 641, 8" href="#" alt="114" class="popup-trigger-bottom">
            <area shape="circle" coords="634, 575, 8" href="#" alt="115" class="popup-trigger-bottom">
            <area shape="circle" coords="635, 480, 8" href="#" alt="116" class="popup-trigger">
            <area shape="circle" coords="635, 430, 8" href="#" alt="117" class="popup-trigger">
            <area shape="circle" coords="624, 349, 8" href="#" alt="118" class="popup-trigger">
            <area shape="circle" coords="509, 327, 8" href="#" alt="119" class="popup-trigger">
            <area shape="circle" coords="429, 329, 8" href="#" alt="120" class="popup-trigger">
            <area shape="circle" coords="353, 328, 8" href="#" alt="121" class="popup-trigger">
            <area shape="circle" coords="275, 328, 8" href="#" alt="122" class="popup-trigger">
            <area shape="circle" coords="156, 327, 8" href="#" alt="123" class="popup-trigger">
            <area shape="circle" coords="44, 268, 8" href="#" alt="201" class="popup-trigger">
            <area shape="circle" coords="46, 211, 8" href="#" alt="202" class="popup-trigger">
            <area shape="circle" coords="46, 152, 8" href="#" alt="203" class="popup-trigger">
            <area shape="circle" coords="44, 93, 8" href="#" alt="204" class="popup-trigger">
            <area shape="circle" coords="46, 37, 8" href="#" alt="205" class="popup-trigger">
            <area shape="circle" coords="102, 37, 8" href="#" alt="206" class="popup-trigger">
            <area shape="circle" coords="156, 37, 8" href="#" alt="207" class="popup-trigger">
            <area shape="circle" coords="215, 39, 8" href="#" alt="208" class="popup-trigger">
            <area shape="circle" coords="274, 37, 8" href="#" alt="209" class="popup-trigger">
            <area shape="circle" coords="350, 34, 8" href="#" alt="210" class="popup-trigger">
            <area shape="circle" coords="510, 35, 8" href="#" alt="211" class="popup-trigger">
            <area shape="circle" coords="582, 33, 8" href="#" alt="212" class="popup-trigger">
            <area shape="circle" coords="669, 35, 8" href="#" alt="213" class="popup-trigger">
            <area shape="circle" coords="745, 40, 8" href="#" alt="214" class="popup-trigger">
            <area shape="circle" coords="814, 39, 8" href="#" alt="215" class="popup-trigger">
            <area shape="circle" coords="881, 37, 8" href="#" alt="216" class="popup-trigger">
            <area shape="circle" coords="998, 37, 8" href="#" alt="217" class="popup-trigger-right">
            <area shape="circle" coords="156, 94, 8" href="#" alt="301" class="popup-trigger">
            <area shape="circle" coords="154, 154, 8" href="#" alt="302" class="popup-trigger">
            <area shape="circle" coords="155, 211, 8" href="#" alt="303" class="popup-trigger">
            <area shape="circle" coords="155, 272, 8" href="#" alt="304" class="popup-trigger">
            <area shape="circle" coords="159, 430, 8" href="#" alt="305" class="popup-trigger">
            <area shape="circle" coords="156, 505, 8" href="#" alt="306" class="popup-trigger">
            <area shape="circle" coords="158, 575, 8" href="#" alt="307" class="popup-trigger-bottom">
            <area shape="circle" coords="158, 646, 8" href="#" alt="308" class="popup-trigger-bottom">
            <area shape="circle" coords="102, 575, 8" href="#" alt="401" class="popup-trigger-bottom">
            <area shape="circle" coords="216, 575, 8" href="#" alt="402" class="popup-trigger-bottom">
            <area shape="circle" coords="274, 575, 8" href="#" alt="403" class="popup-trigger-bottom">
            <area shape="circle" coords="351, 573, 8" href="#" alt="404" class="popup-trigger-bottom">
            <area shape="circle" coords="430, 574, 8" href="#" alt="405" class="popup-trigger-bottom">
            <area shape="circle" coords="509, 573, 8" href="#" alt="406" class="popup-trigger-bottom">
            <area shape="circle" coords="572, 573, 8" href="#" alt="407" class="popup-trigger-bottom">
            <area shape="circle" coords="686, 575, 8" href="#" alt="408" class="popup-trigger-bottom">
            <area shape="circle" coords="744, 575, 8" href="#" alt="409" class="popup-trigger-bottom">
            <area shape="circle" coords="815, 574, 8" href="#" alt="410" class="popup-trigger-bottom">
            <area shape="circle" coords="880, 574, 8" href="#" alt="411" class="popup-trigger-bottom">
            <area shape="circle" coords="881, 480, 8" href="#" alt="412" class="popup-trigger">
            <area shape="circle" coords="881, 432, 8" href="#" alt="413" class="popup-trigger">
            <area shape="circle" coords="882, 348, 8" href="#" alt="414" class="popup-trigger">
            <area shape="circle" coords="881, 268, 8" href="#" alt="415" class="popup-trigger">
            <area shape="circle" coords="882, 211, 8" href="#" alt="416" class="popup-trigger">
            <area shape="circle" coords="880, 109, 8" href="#" alt="417" class="popup-trigger">
            <area shape="circle" coords="274, 93, 8" href="#" alt="501" class="popup-trigger">
            <area shape="circle" coords="275, 154, 8" href="#" alt="502" class="popup-trigger">
            <area shape="circle" coords="274, 211, 8" href="#" alt="503" class="popup-trigger">
            <area shape="circle" coords="274, 268, 8" href="#" alt="504" class="popup-trigger">
            <area shape="circle" coords="271, 430, 8" href="#" alt="505" class="popup-trigger">
            <area shape="circle" coords="275, 503, 8" href="#" alt="506" class="popup-trigger">
            <area shape="circle" coords="274, 645, 8" href="#" alt="507" class="popup-trigger-bottom">
            <area shape="circle" coords="355, 215, 8" href="#" alt="601" class="popup-trigger">
            <area shape="circle" coords="352, 271, 8" href="#" alt="602" class="popup-trigger">
            <area shape="circle" coords="354, 428, 8" href="#" alt="603" class="popup-trigger">
            <area shape="circle" coords="432, 481, 8" href="#" alt="604" class="popup-trigger">
            <area shape="circle" coords="507, 479, 8" href="#" alt="605" class="popup-trigger">
            <area shape="circle" coords="571, 481, 8" href="#" alt="606" class="popup-trigger">
            <area shape="circle" coords="684, 481, 8" href="#" alt="607" class="popup-trigger">
            <area shape="circle" coords="745, 479, 8" href="#" alt="608" class="popup-trigger">
            <area shape="circle" coords="816, 481, 8" href="#" alt="609" class="popup-trigger">
            <area shape="circle" coords="958, 481, 8" href="#" alt="610" class="popup-trigger-right">
            <area shape="circle" coords="999, 431, 8" href="#" alt="611" class="popup-trigger-right">
            <area shape="circle" coords="995, 347, 8" href="#" alt="612" class="popup-trigger-right">
            <area shape="circle" coords="996, 268, 8" href="#" alt="613" class="popup-trigger-right">
            <area shape="circle" coords="1000, 211, 8" href="#" alt="614" class="popup-trigger-right">
            <area shape="circle" coords="998, 158, 8" href="#" alt="615" class="popup-trigger-right">
            <area shape="circle" coords="935, 107, 8" href="#" alt="616" class="popup-trigger-right">
            <area shape="circle" coords="814, 109, 8" href="#" alt="617" class="popup-trigger">
            <area shape="circle" coords="744, 112, 8" href="#" alt="618" class="popup-trigger">
            <area shape="circle" coords="669, 111, 8" href="#" alt="619" class="popup-trigger">
            <area shape="circle" coords="583, 110, 8" href="#" alt="620" class="popup-trigger">
            <area shape="circle" coords="509, 110, 8" href="#" alt="621" class="popup-trigger">
            <area shape="circle" coords="430, 111, 8" href="#" alt="622" class="popup-trigger">
            <area shape="circle" coords="430, 212, 8" href="#" alt="701" class="popup-trigger">
            <area shape="circle" coords="507, 212, 8" href="#" alt="702" class="popup-trigger">
            <area shape="circle" coords="582, 211, 8" href="#" alt="703" class="popup-trigger">
            <area shape="circle" coords="669, 210, 8" href="#" alt="704" class="popup-trigger">
            <area shape="circle" coords="746, 212, 8" href="#" alt="705" class="popup-trigger">
            <area shape="circle" coords="817, 211, 8" href="#" alt="706" class="popup-trigger">
            <area shape="circle" coords="941, 211, 8" href="#" alt="707" class="popup-trigger-right">
            <area shape="circle" coords="680, 698, 8" href="#" alt="801" class="popup-trigger-bottom">
            <area shape="circle" coords="740, 698, 8" href="#" alt="802" class="popup-trigger-bottom">
            <area shape="circle" coords="744, 640, 8" href="#" alt="803" class="popup-trigger-bottom">
            <area shape="circle" coords="746, 430, 8" href="#" alt="804" class="popup-trigger">
            <area shape="circle" coords="744, 349, 8" href="#" alt="805" class="popup-trigger">
            <area shape="circle" coords="744, 268, 8" href="#" alt="806" class="popup-trigger">
            <area shape="circle" coords="509, 640, 8" href="#" alt="901" class="popup-trigger-bottom">
            <area shape="circle" coords="509, 430, 8" href="#" alt="902" class="popup-trigger">
            <area shape="circle" coords="510, 268, 8" href="#" alt="903" class="popup-trigger">
            <area shape="circle" coords="508, 153, 8" href="#" alt="904" class="popup-trigger">
            <div class="popup">
                <p id="stationName"></p>
                <button type="submit" name="start" value="start" id="startButton"><div class="button" id="start">출발역</div></button>
                <button type="submit" name="end" value="end" id="endButton"><div class="button" id="end">도착역</div></button>
                <button type="submit" name="lay" value="lay" id="layButton"><div class="button" id="lay">경유지</div></button>
            </div>
        </map>
    </div>
    <div class="result">
        <div>
            <button type="button" class="reset" id="resetStartButton">x</button><p id="from"></p>
        </div>
        <div>
            <button type="button" class="reset" id="resetEndButton">x</button><p id="to"></p>
        </div>
        <div>
            <button type="button" class="reset" id="resetLayButton">x</button><p id="layover"></p>
        </div>
        <button type="button" onclick="makeItem()" id="search-button">길찾기</button>
        <div class="opacity-bar">
            <input type="range" min="0.4" max="1" step="0.01" value="0.85" id="opacityRange">
        </div>
    </div>
</div>
</body>
</html>
<script>
    const popupTriggers = document.querySelectorAll('.popup-trigger');
    const popupTriggersBottom = document.querySelectorAll('.popup-trigger-bottom');
    const popupTriggersRight = document.querySelectorAll('.popup-trigger-right');
    const popupContent = document.querySelector('.popup');
    const stationNameElement = document.getElementById('stationName');
    const startButton = document.getElementById('startButton');
    const resultStart = document.querySelector('.result div:nth-child(1) p');
    const resultS = document.querySelector('.result div:nth-child(1)');
    const endButton = document.getElementById('endButton');
    const resultEnd = document.querySelector('.result div:nth-child(2) p');
    const resultE = document.querySelector('.result div:nth-child(2)');
    const layButton = document.getElementById('layButton');
    const resultLay = document.querySelector('.result div:nth-child(3) p');
    const resultL = document.querySelector('.result div:nth-child(3)');


    startButton.addEventListener('click', () => {
        const stationName = stationNameElement.innerText;
        resultStart.innerText = `출발역 : ${stationName}`;
        localStorage.setItem("from",stationName)
        resultS.style.opacity = '1';
        resultS.style.visibility = 'visible';
    });

    endButton.addEventListener('click', () => {
        const stationName = stationNameElement.innerText;
        resultEnd.innerText = `도착역 : ${stationName}`;
        localStorage.setItem("to",stationName)
        resultE.style.opacity = '1';
        resultE.style.visibility = 'visible';
    });

    layButton.addEventListener('click', () => {
        const stationName = stationNameElement.innerText;
        resultLay.innerText = `경유지 : ${stationName}`;
        localStorage.setItem("layover",stationName)
        resultL.style.opacity = '1';
        resultL.style.visibility = 'visible';
    });

    const resetStart = () => {
        resultStart.innerText = '';
        resultS.style.opacity = '0';
        resultS.style.visibility = 'hidden';
        localStorage.removeItem('from')
    };

    document.getElementById('resetStartButton').addEventListener('click', resetStart);

    const resetEnd = () => {
        resultEnd.innerText = '';
        resultE.style.opacity = '0';
        resultE.style.visibility = 'hidden';
        localStorage.removeItem('to')
    };

    document.getElementById('resetEndButton').addEventListener('click', resetEnd);

    const resetLay = () => {
        resultLay.innerText = '';
        resultL.style.opacity = '0';
        resultL.style.visibility = 'hidden';
        localStorage.removeItem('layover')
    };

    document.getElementById('resetLayButton').addEventListener('click', resetLay);

    popupTriggers.forEach(trigger => {
        trigger.addEventListener('mouseover', (event) => {
            const mouseX = event.clientX;
            const mouseY = event.clientY;
            const popupWidth = popupContent.offsetWidth;
            const popupHeight = popupContent.offsetHeight;

            // Adjust left position
            let leftPosition = mouseX - 8;
            if (leftPosition + popupWidth > window.innerWidth) {
                leftPosition = window.innerWidth - popupWidth;
            }

            // Adjust top position
            let topPosition = mouseY - 8;
            if (topPosition + popupHeight > window.innerHeight) {
                topPosition = window.innerHeight - popupHeight;
            }

            popupContent.style.left = leftPosition + 'px';
            popupContent.style.top = topPosition + 'px';

            stationNameElement.innerText = trigger.getAttribute('alt');

            popupContent.style.visibility = 'visible';
            popupContent.style.opacity = '1';
        });

        trigger.addEventListener('mouseout', () => {
            popupContent.style.visibility = 'hidden';
            popupContent.style.opacity = '0';
        });
    });

    popupTriggersBottom.forEach(trigger => {
        trigger.addEventListener('mouseover', (event) => {
            const mouseX = event.clientX;
            const mouseY = event.clientY;
            const popupWidth = popupContent.offsetWidth;
            const popupHeight = popupContent.offsetHeight;

            // Adjust left position
            let leftPosition = mouseX - 5;
            if (leftPosition + popupWidth > window.innerWidth) {
                leftPosition = window.innerWidth - popupWidth;
            }

            // Adjust top position
            let topPosition = mouseY - 165;
            if (topPosition + popupHeight > window.innerHeight) {
                topPosition = window.innerHeight - popupHeight;
            }

            popupContent.style.left = leftPosition + 'px';
            popupContent.style.top = topPosition + 'px';

            stationNameElement.innerText = trigger.getAttribute('alt');

            popupContent.style.visibility = 'visible';
            popupContent.style.opacity = '1';
        });

        trigger.addEventListener('mouseout', () => {
            popupContent.style.visibility = 'hidden';
            popupContent.style.opacity = '0';
        });
    });

    popupTriggersRight.forEach(trigger => {
        trigger.addEventListener('mouseover', (event) => {
            const mouseX = event.clientX;
            const mouseY = event.clientY;
            const popupWidth = popupContent.offsetWidth;
            const popupHeight = popupContent.offsetHeight;

            // Adjust left position
            let leftPosition = mouseX - 115;
            if (leftPosition + popupWidth > window.innerWidth) {
                leftPosition = window.innerWidth - popupWidth;
            }

            // Adjust top position
            let topPosition = mouseY - 5;
            if (topPosition + popupHeight > window.innerHeight) {
                topPosition = window.innerHeight - popupHeight;
            }

            popupContent.style.left = leftPosition + 'px';
            popupContent.style.top = topPosition + 'px';

            stationNameElement.innerText = trigger.getAttribute('alt');

            popupContent.style.visibility = 'visible';
            popupContent.style.opacity = '1';
        });

        trigger.addEventListener('mouseout', () => {
            popupContent.style.visibility = 'hidden';
            popupContent.style.opacity = '0';
        });
    });

    popupContent.addEventListener('mouseover', () => {
        popupContent.style.visibility = 'visible';
        popupContent.style.opacity = '1';
    });

    popupContent.addEventListener('mouseout', () => {
        popupContent.style.visibility = 'hidden';
        popupContent.style.opacity = '0';
    });

    const draggableElement = document.querySelector('.result');

    let startX, startY, initialPositionX, initialPositionY;

    const isResultDivOrChild = (target) => {
        return (
            target === draggableElement ||
            draggableElement.contains(target)
        );
    };

    const startDrag = (event) => {
        if (
            (event.type === 'mousedown' && event.button === 0) ||
            (event.type === 'touchstart' && event.touches.length === 1 && isResultDivOrChild(event.target))
        ) {
            startX = event.clientX || event.touches[0].clientX;
            startY = event.clientY || event.touches[0].clientY;

            const style = window.getComputedStyle(draggableElement);
            initialPositionX = parseInt(style.getPropertyValue('left'));
            initialPositionY = parseInt(style.getPropertyValue('top'));

            if (event.type === 'mousedown') {
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', stopDrag);
            } else if (event.type === 'touchstart') {
                document.addEventListener('touchmove', drag, { passive: false });
                document.addEventListener('touchend', stopDrag);
            }
        }
    };

    const drag = (event) => {
        const clientX = event.clientX || event.touches[0].clientX;
        const clientY = event.clientY || event.touches[0].clientY;

        const deltaX = clientX - startX;
        const deltaY = clientY - startY;

        draggableElement.style.left = `${initialPositionX + deltaX}px`;
        draggableElement.style.top = `${initialPositionY + deltaY}px`;

        // Prevent other elements from receiving touch events
        event.preventDefault();
    };

    const stopDrag = () => {
        document.removeEventListener('mousemove', drag);
        document.removeEventListener('mouseup', stopDrag);
        document.removeEventListener('touchmove', drag);
        document.removeEventListener('touchend', stopDrag);
    };

    draggableElement.addEventListener('mousedown', startDrag);
    draggableElement.addEventListener('touchstart', startDrag);

    const opacityRange = document.getElementById("opacityRange");
    const resultDiv = document.querySelector(".result");

    opacityRange.addEventListener("input", function() {
        resultDiv.style.opacity = this.value;
    });

    opacityRange.addEventListener("mousedown", (event) => {
        event.stopPropagation();
    });

    // Touch events for mobile devices
    opacityRange.addEventListener("touchstart", (event) => {
        event.stopPropagation(); // Prevent touch events from reaching other elements

        const startTouchX = event.touches[0].clientX;
        const initialOpacity = parseFloat(opacityRange.value);

        const touchMoveHandler = (moveEvent) => {
            const currentTouchX = moveEvent.touches[0].clientX;
            const deltaTouchX = currentTouchX - startTouchX;

            // Calculate the new opacity value based on touch movement
            const newOpacity = Math.max(0.4, Math.min(1, initialOpacity + deltaTouchX / opacityRange.offsetWidth));

            // Update the opacity and the range input value
            resultDiv.style.opacity = newOpacity;
            opacityRange.value = newOpacity.toFixed(2);

            moveEvent.preventDefault();
        };

        const touchEndHandler = () => {
            // Remove the touchmove and touchend event listeners when dragging ends
            document.removeEventListener("touchmove", touchMoveHandler);
            document.removeEventListener("touchend", touchEndHandler);
        };

        // Attach touchmove and touchend event listeners
        document.addEventListener("touchmove", touchMoveHandler, { passive: false });
        document.addEventListener("touchend", touchEndHandler);
    });

    function makeItem(){
        const from = localStorage.getItem('from')
        const to = localStorage.getItem('to')
        const layover = localStorage.getItem('layover')

        if (layover === null) {
            if (from === null || to === null){
                alert('역 정보를 입력하세요.')
                return
            }
            if (from===to) {
                alert('출발역과 도착역이 같습니다.')
                return
            }
            location.href="route"
        } else {
            if (from === null || to === null){
                alert('역 정보를 입력하세요.')
                return
            }
            if (from===layover) {
                alert('출발역과 경유지가 같습니다.')
                return
            }
            if (layover===to){
                alert('경유지와 도착역이 같습니다.')
                return
            }
            location.href="route"
        }
    }
</script>